<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Compile Android From Source - UDOO Neo Docs</title>
    <meta name="description" content="UDOO Neo Documentation" />
    <meta name="author" content="UDOO Team">
    <meta charset="UTF-8">
    <link rel="icon" href="../themes/daux/img/favicon-udoo.ico" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../themes/daux/css/theme-navy.min.css' rel='stylesheet' type='text/css'><link href='../themes/daux/css/udoo.css' rel='stylesheet' type='text/css'>
            <!-- Tipue Search -->
        <link href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    <!-- jQuery -->
    <script src="../themes/daux/js/jquery-1.11.3.min.js"></script>
    <script src="../themes/daux/js/bootstrap.min.js"></script>

    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="">
    
<header class="Navbar hidden-print">
    <img class="pull-left udoologo" src="/docs/img/logos/neo.png"> 
<a class="Navbar__brand" href="../index.html">
UDOO Neo Documentation</a>

    <div class="Search">
        <svg class="Search__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451 451"><path d="M447.05 428l-109.6-109.6c29.4-33.8 47.2-77.9 47.2-126.1C384.65 86.2 298.35 0 192.35 0 86.25 0 .05 86.3.05 192.3s86.3 192.3 192.3 192.3c48.2 0 92.3-17.8 126.1-47.2L428.05 447c2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4c5.2-5.2 5.2-13.8 0-19zM26.95 192.3c0-91.2 74.2-165.3 165.3-165.3 91.2 0 165.3 74.2 165.3 165.3s-74.1 165.4-165.3 165.4c-91.1 0-165.3-74.2-165.3-165.4z"/></svg>
        <input type="search" id="tipue_search_input" class="Search__field" placeholder="Search..." autocomplete="on" results=25 autosave=text_search>
    </div>
</header>
<div class="Columns content">
    <aside class="Columns__left Collapsible">
        <div class="Collapsible__container">
            <button type="button" class="Button Collapsible__trigger">
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
            </button>
        </div>

        <div class="Collapsible__content">
            <!-- Navigation -->
            <ul class='Nav'><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Introduction</a><ul class='Nav'><li class='Nav__item '><a href="../Introduction/Introduction.html">Introduction</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Getting Started</a><ul class='Nav'><li class='Nav__item '><a href="../Getting_Started/Very_First_Start.html">Very First Start</a></li><li class='Nav__item '><a href="../Getting_Started/Create_a_bootable_MicroSD_card_for_UDOO_Neo.html">Create a bootable MicroSD card for UDOO Neo</a></li><li class='Nav__item '><a href="../Getting_Started/Use_as_a_headless_IoT_Device.html">Use as a headless IoT Device</a></li><li class='Nav__item '><a href="../Getting_Started/Use_as_a_Lightweight_Desktop_PC.html">Use as a Lightweight Desktop PC</a></li><li class='Nav__item '><a href="../Getting_Started/Use_as_an_Arduino.html">Use as an Arduino</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Basic Setup</a><ul class='Nav'><li class='Nav__item '><a href="../Basic_Setup/Usb_Direct_Connection.html">Usb Direct Connection</a></li><li class='Nav__item '><a href="../Basic_Setup/Web_Control_Panel.html">Web Control Panel</a></li><li class='Nav__item '><a href="../Basic_Setup/Remote_Terminal_(SSH).html">Remote Terminal (SSH)</a></li><li class='Nav__item '><a href="../Basic_Setup/Remote_Desktop_(VNC).html">Remote Desktop (VNC)</a></li><li class='Nav__item '><a href="../Basic_Setup/Serial_Debug_Console.html">Serial Debug Console</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Software & Operating Systems</a><ul class='Nav'><li class='Nav__item '><a href="../Software_Operating_Systems/UDOObuntu.html">UDOObuntu</a></li><li class='Nav__item '><a href="../Software_Operating_Systems/Android.html">Android</a></li><li class='Nav__item '><a href="../Software_Operating_Systems/Yocto.html">Yocto</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Hardware & Accessories</a><ul class='Nav'><li class='Nav__item '><a href="../Hardware_Accessories/Motion_sensors.html">Motion sensors</a></li><li class='Nav__item '><a href="../Hardware_Accessories/Bricks_snap_in_sensors.html">Bricks snap in sensors</a></li><li class='Nav__item '><a href="../Hardware_Accessories/GPIO.html">GPIO</a></li><li class='Nav__item '><a href="../Hardware_Accessories/UART_serial_ports.html">UART serial ports</a></li><li class='Nav__item '><a href="../Hardware_Accessories/I2C_bus.html">I2C bus</a></li><li class='Nav__item '><a href="../Hardware_Accessories/SPI_bus.html">SPI bus</a></li><li class='Nav__item '><a href="../Hardware_Accessories/CAN_bus.html">CAN bus</a></li><li class='Nav__item '><a href="../Hardware_Accessories/LVDS_panels.html">LVDS panels</a></li><li class='Nav__item '><a href="../Hardware_Accessories/PWM.html">PWM</a></li><li class='Nav__item '><a href="../Hardware_Accessories/ADC.html">ADC</a></li><li class='Nav__item '><a href="../Hardware_Accessories/USB_to_TTL_Serial_Debug_Module.html">USB-to-TTL Serial Debug Module</a></li><li class='Nav__item '><a href="../Hardware_Accessories/I2S.html">I2S</a></li><li class='Nav__item '><a href="../Hardware_Accessories/HDMI_7inch_touch.html">HDMI 7inch touch</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Wireless Communication</a><ul class='Nav'><li class='Nav__item '><a href="../Wireless_Communication/WiFi.html">WiFi</a></li><li class='Nav__item '><a href="../Wireless_Communication/WiFi_SoftAP.html">WiFi SoftAP</a></li><li class='Nav__item '><a href="../Wireless_Communication/Bluetooth.html">Bluetooth</a></li><li class='Nav__item '><a href="../Wireless_Communication/Bluetooth_NAP.html">Bluetooth NAP</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Cookbook Linux</a><ul class='Nav'><li class='Nav__item '><a href="../Cookbook_Linux/Understanding_Linux_Software_Management_And_Installing.html">Understanding Linux Software Management And Installing</a></li><li class='Nav__item '><a href="../Cookbook_Linux/Linux_Command_Line_Interface.html">Linux Command Line Interface</a></li><li class='Nav__item '><a href="../Cookbook_Linux/Set_video_output.html">Set video output</a></li><li class='Nav__item '><a href="../Cookbook_Linux/Device_Tree_Editor.html">Device Tree Editor</a></li><li class='Nav__item '><a href="../Cookbook_Linux/Change_Web_Control_Panel_port.html">Change Web Control Panel port</a></li><li class='Nav__item '><a href="../Cookbook_Linux/Turn_off_M4_Arduino_core.html">Turn off M4 Arduino core</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Arduino M4 Processor</a><ul class='Nav'><li class='Nav__item '><a href="../Arduino_M4_Processor/Overview.html">Overview</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Pinout.html">Pinout</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Communication.html">Communication</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Programming_Arduino_M4_from_Internal_Processor(Cortex_A9).html">Programming Arduino M4 from Internal Processor(Cortex-A9)</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Programming_Arduino_M4_from_External_PC.html">Programming Arduino M4 from External PC</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Debugging.html">Debugging</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Arduino_differences.html">Arduino differences</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Porting_Libraries.html">Porting Libraries</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Controlling_9_axis_motion_sensors.html">Controlling 9-axis motion sensors</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Use_more_digital_pins_on_M4.html">Use more digital pins on M4</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Cookbook Arduino M4</a><ul class='Nav'><li class='Nav__item '><a href="../Cookbook_Arduino_M4/Hall_Sensor.html">Hall Sensor</a></li><li class='Nav__item '><a href="../Cookbook_Arduino_M4/RGB_led.html">RGB led</a></li><li class='Nav__item '><a href="../Cookbook_Arduino_M4/Two_color_common_cathode_led.html">Two color common cathode led</a></li><li class='Nav__item '><a href="../Cookbook_Arduino_M4/Knock_sensor.html">Knock sensor</a></li><li class='Nav__item '><a href="../Cookbook_Arduino_M4/Infrared_Transmit.html">Infrared Transmit</a></li></ul></li><li class='Nav__item  has-children'><a href="../Serial_Libraries/index.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Serial Libraries</a><ul class='Nav'><li class='Nav__item '><a href="../Serial_Libraries/Java_Serial_Libraries.html">Java Serial Libraries</a></li><li class='Nav__item '><a href="../Serial_Libraries/C_Serial_Libraries.html">C Serial Libraries</a></li><li class='Nav__item '><a href="../Serial_Libraries/PHP_Serial_Libraries.html">PHP Serial Libraries</a></li><li class='Nav__item '><a href="../Serial_Libraries/Python_Serial_Libraries.html">Python Serial Libraries</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Cookbook Android</a><ul class='Nav'><li class='Nav__item '><a href="../Cookbook_Android/UDOO_Android_Boot_Walkthrough.html">UDOO Android Boot Walkthrough</a></li><li class='Nav__item '><a href="../Cookbook_Android/UDOO_Android_Settings.html">UDOO Android Settings</a></li><li class='Nav__item '><a href="../Cookbook_Android/How_To_Install_Gapps_On_UDOO_Running_Android.html">How To Install Gapps On UDOO Running Android</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Debugging & Troubleshooting</a><ul class='Nav'><li class='Nav__item '><a href="../Debugging_Troubleshooting/Arduino_programming_from_internal_IDE.html">Arduino programming from internal IDE</a></li><li class='Nav__item '><a href="../Debugging_Troubleshooting/Arduino_String_issue.html">Arduino String issue</a></li><li class='Nav__item '><a href="../Debugging_Troubleshooting/USB_stops_working_after_programming_M4.html">USB stops working after programming M4</a></li></ul></li><li class='Nav__item Nav__item--open has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Advanced Topics</a><ul class='Nav'><li class='Nav__item '><a href="../Advanced_Topics/Setup_development_environment.html">Setup development environment</a></li><li class='Nav__item '><a href="../Advanced_Topics/Compile_UDOObuntu_(complete_bootable_image).html">Compile UDOObuntu (complete bootable image)</a></li><li class='Nav__item '><a href="../Advanced_Topics/Compile_U_Boot_Bootloader.html">Compile U-Boot Bootloader</a></li><li class='Nav__item '><a href="../Advanced_Topics/Compile_Linux_Kernel.html">Compile Linux Kernel</a></li><li class='Nav__item Nav__item--active'><a href="../Advanced_Topics/Compile_Android_From_Source.html">Compile Android From Source</a></li><li class='Nav__item '><a href="../Advanced_Topics/Recompile_MQX_Libraries.html">Recompile MQX Libraries</a></li><li class='Nav__item '><a href="../Advanced_Topics/Boot_process.html">Boot process</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Hardware Reference</a><ul class='Nav'><li class='Nav__item '><a href="../Hardware_Reference/Overview.html">Overview</a></li><li class='Nav__item '><a href="../Hardware_Reference/Resources.html">Resources</a></li><li class='Nav__item '><a href="../Hardware_Reference/Board_versions.html">Board versions</a></li><li class='Nav__item '><a href="../Hardware_Reference/Processor.html">Processor</a></li><li class='Nav__item '><a href="../Hardware_Reference/RAM.html">RAM</a></li><li class='Nav__item '><a href="../Hardware_Reference/Power_Management.html">Power Management</a></li><li class='Nav__item '><a href="../Hardware_Reference/PC_USB_interface.html">PC USB interface</a></li><li class='Nav__item '><a href="../Hardware_Reference/Indicator_LED.html">Indicator LED</a></li><li class='Nav__item '><a href="../Hardware_Reference/JTAG_header.html">JTAG header</a></li><li class='Nav__item '><a href="../Hardware_Reference/VADC_Analog_Camera.html">VADC Analog Camera</a></li><li class='Nav__item '><a href="../Hardware_Reference/Ethernet.html">Ethernet</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>UDOO NEO made by the Community</a><ul class='Nav'><li class='Nav__item '><a href="../UDOO_NEO_made_by_the_Community/Python.html">Python</a></li><li class='Nav__item '><a href="../UDOO_NEO_made_by_the_Community/Java.html">Java</a></li><li class='Nav__item '><a href="../UDOO_NEO_made_by_the_Community/Builds_based_on_other_kernels.html">Builds based on other kernels</a></li><li class='Nav__item '><a href="../UDOO_NEO_made_by_the_Community/Drivers_Modules_And_Tools.html">Drivers Modules And Tools</a></li></ul></li></ul>

            <div class="Links">
                                    <hr/>
                                            <a href="https://www.udoo.org" target="_blank">Home</a>
                        <br />
                                            <a href="https://www.udoo.org/downloads" target="_blank">Downloads</a>
                        <br />
                                            <a href="https://www.udoo.org/tutorial" target="_blank">Tutorials</a>
                        <br />
                                            <a href="https://www.udoo.org/forum" target="_blank">Forum</a>
                        <br />
                                    
                
                            </div>
        </div>
    </aside>
    <div class="Columns__right ">
        <div class="Columns__right__content">
            <div class="doc_content">
                <article class="Page">

    <div class="Page__header">
        <h1>Compile Android From Source</h1>
            </div>


    <div class="s-content">
        <p>This describes the necessary steps to start and use the pre-compiled Android software support package for UDOO NEO Board. Moreover, a description of how to rebuild the bootloader, kernel and Android file system is provided. The procedure described in this wiki refers to UDOO NEO.</p>
<h2 id="page_System-Requirements">System Requirements</h2>
<p>Android system for UDOO NEO board is provided as precompiled images or as source code to be customized and rebuilt. Running the full procedure described in this wiki, rebuilding the Android system from source files, it is necessary to have an host PC (or Virtual Machine) running Ubuntu Linux 14.04 64bit with at least 40 GB of free disk space, configured in the set up the work environment section below. The host PC should also include:</p>
<ul>
<li>an SD/µSD card reader;</li>
<li>an host pc with internet connection;</li>
<li>a microUSB cable to connect UDOO NEO to host and access debug serial (optional);</li>
</ul>
<h3 id="page_Terminology">Terminology</h3>
<p>The set of scripts and images necessary to run Android on a board is generically called a Distro.</p>
<h2 id="page_Setting-up-a-Linux-build-environment">Setting up a Linux build environment</h2>
<p>Regarding the development environment, you need to first make sure to comply with the <code>AOSP</code> (Android Open Source Project) requirements. Note that it requires a <code>64-bit</code> version of <code>Linux</code>. Follow this official link for <a href="https://source.android.com/source/initializing.html" class="Link--external">Establishing a Build Environment</a>.</p>
<p>We suggest to use a Virtual Machine environment to create a close and dedicated workspace. It reduce risks of procedure and libraries mismatching or to corrupt other working enviroments present on the host machine.</p>
<p>Building 5.x Lollipop and 6.0.x Marshmallow versions for UDOO NEO only requires to have <code>OpenJDK v7</code> (the v8 as specified in the official Android docs is required only to compile the next Android N).</p>
<pre><code>~$ sudo apt-get install openjdk-7-jdk
</code></pre>
<p>The packages needed to build the AOSP
In addition to the AOSP requirements, the following packages are needed to build NXP/Freescale components:</p>
<pre><code>~$ sudo apt-get install uuid uuid-dev zip lzop gperf zlib1g-dev \
liblz-dev liblzo2-2 liblzo2-dev u-boot-tools lib32z1 flex git-core \
curl mtd-utils android-tools-fsutils
</code></pre>
<p>At this page you can find how to <a href="Setup_development_environment.html">create a Virtual Machine for Development</a>. Remember you need a 64 bit Linux Distro to compile Android.</p>
<h2 id="page_Serial-communication">Serial communication</h2>
<p>While not exactly necessary, serial communication with UDOO NEO is strongly recommended as the first debug method. In order to use the serial debug port on UDOO NEO, after connecting the board and host PC ports, it is necessary to install and setup an application for serial communication, such as minicom. At this page you can find how to <a href="../Basic_Setup/Serial_Debug_Console.html">Conecting via Serial Cable</a>.</p>
<p>The serial debug port is used for two different reasons: The bootloader and kernel send debug messages via serial port, so that the user can monitor the low level system state; a root console is opened on the serial port, allowing bootloader configuration and system control.</p>
<p>The number of messages sent via serial port can be very high. For this reason, it is quite useful to increase scrolling capabilities of the terminal, possibly setting them to a very high or even unlimited.</p>
<h2 id="page_Download-the-source-code">Download the source code</h2>
<p>Next step is downloading the source code. To do so you need the <a href="https://source.android.com/source/using-repo.html" class="Link--external"><code>repo</code></a> tool which has been developed especially for Android in order to manage the hundreds of Git repositories this project contains:</p>
<pre><code class="language-bash">
~$ cd ~
~$ mkdir myandroid bin
~$ curl http://commondatastorage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo
~$ chmod a+x ~/bin/repo
~$ cd myandroid
~$ ~/bin/repo init -u https://github.com/UDOOboard/android_udoo_platform_manifest -b android-6.0.1
~$ ~/bin/repo sync -j5

</code></pre>
<p>N.B. the <code>repo sync</code> loads the repos needed. Therefore, it can take several hours to load. The <code>-jN</code> command run <code>N</code> tasks at the same time to speed up this process.</p>
<h2 id="page_Configure-the-environment">Configure the environment</h2>
<p>Prior to build the system, it is necessary to configure the Android environment for the specific build. In particular, the following commands have to be launched:</p>
<pre><code class="language-bash">
~$ export ARCH=arm
~$ source build/envsetup.sh

</code></pre>
<p>Finally, it is necessary to choose which target to build. The command below shows a list of possible targets</p>
<pre><code class="language-bash">
~$ lunch

</code></pre>
<p>For each possible target, the first part of the name indicates the board you are building for, while the second part selects the build type, as described <a href="http://source.android.com/source/building.html" class="Link--external">here</a>.</p>
<p>In particular, valid options to build for UDOO NEO board are:</p>
<ul>
<li>udooneo_6sx-user: build for production, with limited access</li>
<li>udooneo_6sx-eng: build for development, with root access and additional debugging tools</li>
</ul>
<p>The target selection can alternatively be done directly at command line, calling for example</p>
<pre><code class="language-bash">
~$ lunch udooneo_6sx-eng

</code></pre>
<p>Once all these steps are done, several environment variables are set. Among the rest, it is worth noting the environment variable OUT, automatically set to <code>udoo-android-dev]/out/target/product/udooneo_6sx</code>, that is the folder where Android system is actually built, and where object files, folders and system images are created. From now on, this folder is called [OUT].</p>
<h2 id="page_Build-Android-system-image">Build Android system image</h2>
<p>The easiest but most time-consuming step in building Android is to build the Android system image. In general, after configuring the environment as in configuration section, it is sufficient to launch the following command (from the main folder [udoo-android-dev]) to build the whole system image, including the kernel:</p>
<p>The code:</p>
<pre><code class="language-bash">
~$ make

</code></pre>
<p>The duration of the whole system build is strongly dependent on the host PC you are working on, but this can take up to several hours, and builds more than 20GB of compiled code (this is the size of the [udoo-android-dev]/out/ folder when the operation is completed). Enabling parallel compilation can speed up the process.</p>
<p>In general, the idea is to let the compiler to launch several compiling jobs in parallel, where the number of jobs depends on the specific PC you are working on.</p>
<pre><code class="language-bash">
~$ make -jN

</code></pre>
<p>where N is the maximum number of parallel jobs allowed. For a better explanation of this point (included the value to assign to N), please consult  <a href="http://source.android.com/source/building.html" class="Link--external">http://source.android.com/source/building.html</a>, in Build the Code section above.</p>
<p>Several files and folders are created in [OUT]. Among the rest we underline:</p>
<ul>
<li>root/ and ramdisk.img: root file system and generated image</li>
<li>recovery/ and ramdisk-recovery.img: root file system used in recovery mode, and generated image</li>
<li>system/ and system.img: Android system including binaries and libraries, and generated image</li>
<li>data/ and userdata.img: Android data area and generated image</li>
<li>kernel and uImage: kernel images</li>
<li>boot.img: kernel and initial root ramdisk, generated from kernel and ramdisk.img</li>
<li>recovery.img: kernel and initial root ramdisk used in recovery mode, generated from kernel and ramdisk-recovery.img</li>
<li>u-boot.imx: the U-Boot bootloader. This is the first executed binary that loads the kernel and all the system.</li>
</ul>
<p>The images are sufficient to boot UDOO NEO board with the default kernel configuration.</p>
<h2 id="page_Create-a-microSD-from-the-Android-built-files">Create a microSD from the Android built files</h2>
<p>Once the new Android system images are created, it is necessary to prepare a µSD card with the images and boot UDOO NEO board. A script is provided to help with this step. In a way similar to what is described in the Run Android section, the script will partition and format the SD card and then copies the new Android images into the correct partitions, reading them directly from [$OUT]. It is sufficient to follow the next steps.</p>
<p>Connect the SD card to your host PC, and use the <code>dmesg</code> or <code>fdisk -l</code> commands to find the device name; we suppose it is /dev/sdc.</p>
<p>Launch the script to prepare the SD</p>
<pre><code class="language-bash">
~$ cp make_sd.sh $OUT
~$ cd $OUT
~$ sudo -E ./make_sd.sh /dev/sdc

</code></pre>
<p>When this is done, the SD card containing the images is ready to boot UDOO NEO as described in the Boot Android from SD section.</p>
<h2 id="page_Prepare-a-Distro">Prepare a Distro</h2>
<p>It is sometimes useful to prepare a new Distro to be stored.</p>
<p>To do this, once the new images are built following the procedures described in the previous Sections, it is sufficient to call the command</p>
<pre><code class="language-bash">
~$ ./prepare_distro.sh [distro_name]

</code></pre>
<p>The script creates a new folder [distro_name], containing the freshly built Android system images, and the scripts to use them. An archive [distro_name].tar.gz is also prepared for distribution. Once the archive is ready, you can follow the above section to create a microSD from the Android built files.</p>
<h2 id="page_Boot-Android-from-microSD">Boot Android from microSD</h2>
<p>When the <code>make_sd</code> script ends, insert the SD into the SD card slot and power up the device. The Android system boots. You can see the Android bootscreen on a connected HDMI monitor within 20 seconds, while messages on the serial debug port start to be sent almost immediately. First of all, messages from the bootloader can be seen. Among the rest, characteristics of the board are shown: CPU type, boot device and memory size. Please check the correctness of this information. The kernel is automatically launched after a 3 second countdown. The first time Android System boots, it must configure the storage amd prepare folders for data and applications. As a consequence, every time the SD is prepared with the procedure described in this section, the first boot takes around 1 minute, while subsequent boots are much faster. At the end of the boot procedure, you can interact with the system either with mouse and keyboard and the HDMI display, or with a root console automatically opened in serial.</p>
<h3 id="page_Build-Kernel">Build Kernel</h3>
<p>The kernel is built together with the rest of the Android system. However, it is also possible to modify the configuration and rebuild it separately. As for the bootloader, the kernel can be configured and customized for a very wide range of boards and peripherals. Linux kernel customization is a very complex task, an in-depth description is out of the scope of this document. Here we consider only the default configuration to run linux kernel on UDOO NEO board.</p>
<p>It is possible to configure (or restore) the kernel to the default configuration for the Module calling the command below:</p>
<p>The command:</p>
<pre><code class="language-bash">
~$ make -C kernel_imx udoo_neo_android_defconfig

</code></pre>
<p>If you wish to check the configuration or customize it, use</p>
<pre><code class="language-bash">
~$ make -C kernel_imx menuconfig

</code></pre>
<p>The command opens a graphical configuration tool. Any saved change is stored in the same folder as an hidden file called .config, which then is the actual configuration file used to compile the kernel.</p>
<p>Once the configuration is ready, the kernel is compiled with command</p>
<pre><code class="language-bash">
~$ make bootimage

</code></pre>
<p>This operation can take up to 30 minutes to complete, and performs several actions:</p>
<ul>
<li>builds the kernel, creating the images uImage and zImage in [udoo-android-dev]/kernel_imx/arch/arm/boot</li>
<li>copies the kernel images in [OUT] (zImage is renamed to kernel)</li>
<li>updates root/ and ramdisk.img</li>
<li>updates boot.img from ramdisk.img and kernel</li>
</ul>
<p>When it is done, the new boot.img is present in [OUT], ready to be used to boot the Module.
Android Build system caches most of the file compiled, sometimes it may happen that some changes aren't reported in the final compiled boot.img. If this happens we suggest to delete from the $OUT folder these file: <code>boot.img</code>, <code>kernel</code>, <code>obj/KERNEL_OBJ/*</code> in order to recompile all the Kernel.</p>
    </div>

        <nav>
        <ul class="Pager">
            <li class=Pager--prev><a href="../Advanced_Topics/Compile_Linux_Kernel.html">Previous</a></li>            <li class=Pager--next><a href="../Advanced_Topics/Recompile_MQX_Libraries.html">Next</a></li>        </ul>
    </nav>
    
<span style="float: left; font-size: 10px; color: gray;">
This page was last updated on Friday, June 10, 2022 at 9:21 AM.
</span>

</article>

            </div>
        </div>
    </div>
</div>

    
    <!-- hightlight.js -->
    <script src="../themes/daux/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="../themes/daux/js/daux.js"></script>

            <!-- Tipue Search -->
        <script type="text/javascript" src="../tipuesearch/tipuesearch.js"></script>

        <script>
            window.onunload = function(){}; // force $(document).ready to be called on back/forward navigation in firefox
            $(function() {
                tipuesearch({
                    'base_url': '../'
                });
            });
        </script>
    
</body>
</html>
