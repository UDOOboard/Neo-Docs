<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>USB stops working after programming M4 - UDOO Neo Docs</title>
    <meta name="description" content="UDOO Neo Documentation" />
    <meta name="author" content="UDOO Team">
    <meta charset="UTF-8">
    <link rel="icon" href="../themes/daux/img/favicon-udoo.ico" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../themes/daux/css/theme-navy.min.css' rel='stylesheet' type='text/css'><link href='../themes/daux/css/udoo.css' rel='stylesheet' type='text/css'>
            <!-- Tipue Search -->
        <link href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    <!-- jQuery -->
    <script src="../themes/daux/js/jquery-1.11.3.min.js"></script>
    <script src="../themes/daux/js/bootstrap.min.js"></script>

    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="">
    
<header class="Navbar hidden-print">
    <img class="pull-left udoologo" src="/docs/img/logos/neo.png"> 
<a class="Navbar__brand" href="../index.html">
UDOO Neo Documentation</a>

    <div class="Search">
        <svg class="Search__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451 451"><path d="M447.05 428l-109.6-109.6c29.4-33.8 47.2-77.9 47.2-126.1C384.65 86.2 298.35 0 192.35 0 86.25 0 .05 86.3.05 192.3s86.3 192.3 192.3 192.3c48.2 0 92.3-17.8 126.1-47.2L428.05 447c2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4c5.2-5.2 5.2-13.8 0-19zM26.95 192.3c0-91.2 74.2-165.3 165.3-165.3 91.2 0 165.3 74.2 165.3 165.3s-74.1 165.4-165.3 165.4c-91.1 0-165.3-74.2-165.3-165.4z"/></svg>
        <input type="search" id="tipue_search_input" class="Search__field" placeholder="Search..." autocomplete="on" results=25 autosave=text_search>
    </div>
</header>
<div class="Columns content">
    <aside class="Columns__left Collapsible">
        <div class="Collapsible__container">
            <button type="button" class="Button Collapsible__trigger">
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
            </button>
        </div>

        <div class="Collapsible__content">
            <!-- Navigation -->
            <ul class='Nav'><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Introduction</a><ul class='Nav'><li class='Nav__item '><a href="../Introduction/Introduction.html">Introduction</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Getting Started</a><ul class='Nav'><li class='Nav__item '><a href="../Getting_Started/Very_First_Start.html">Very First Start</a></li><li class='Nav__item '><a href="../Getting_Started/Create_a_bootable_MicroSD_card_for_UDOO_Neo.html">Create a bootable MicroSD card for UDOO Neo</a></li><li class='Nav__item '><a href="../Getting_Started/Use_as_a_headless_IoT_Device.html">Use as a headless IoT Device</a></li><li class='Nav__item '><a href="../Getting_Started/Use_as_a_Lightweight_Desktop_PC.html">Use as a Lightweight Desktop PC</a></li><li class='Nav__item '><a href="../Getting_Started/Use_as_an_Arduino.html">Use as an Arduino</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Basic Setup</a><ul class='Nav'><li class='Nav__item '><a href="../Basic_Setup/Usb_Direct_Connection.html">Usb Direct Connection</a></li><li class='Nav__item '><a href="../Basic_Setup/Web_Control_Panel.html">Web Control Panel</a></li><li class='Nav__item '><a href="../Basic_Setup/Remote_Terminal_(SSH).html">Remote Terminal (SSH)</a></li><li class='Nav__item '><a href="../Basic_Setup/Remote_Desktop_(VNC).html">Remote Desktop (VNC)</a></li><li class='Nav__item '><a href="../Basic_Setup/Serial_Debug_Console.html">Serial Debug Console</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Software & Operating Systems</a><ul class='Nav'><li class='Nav__item '><a href="../Software_Operating_Systems/UDOObuntu.html">UDOObuntu</a></li><li class='Nav__item '><a href="../Software_Operating_Systems/Android.html">Android</a></li><li class='Nav__item '><a href="../Software_Operating_Systems/Yocto.html">Yocto</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Hardware & Accessories</a><ul class='Nav'><li class='Nav__item '><a href="../Hardware_Accessories/Motion_sensors.html">Motion sensors</a></li><li class='Nav__item '><a href="../Hardware_Accessories/Bricks_snap_in_sensors.html">Bricks snap in sensors</a></li><li class='Nav__item '><a href="../Hardware_Accessories/GPIO.html">GPIO</a></li><li class='Nav__item '><a href="../Hardware_Accessories/UART_serial_ports.html">UART serial ports</a></li><li class='Nav__item '><a href="../Hardware_Accessories/I2C_bus.html">I2C bus</a></li><li class='Nav__item '><a href="../Hardware_Accessories/SPI_bus.html">SPI bus</a></li><li class='Nav__item '><a href="../Hardware_Accessories/CAN_bus.html">CAN bus</a></li><li class='Nav__item '><a href="../Hardware_Accessories/LVDS_panels.html">LVDS panels</a></li><li class='Nav__item '><a href="../Hardware_Accessories/PWM.html">PWM</a></li><li class='Nav__item '><a href="../Hardware_Accessories/ADC.html">ADC</a></li><li class='Nav__item '><a href="../Hardware_Accessories/USB_to_TTL_Serial_Debug_Module.html">USB-to-TTL Serial Debug Module</a></li><li class='Nav__item '><a href="../Hardware_Accessories/I2S.html">I2S</a></li><li class='Nav__item '><a href="../Hardware_Accessories/HDMI_7inch_touch.html">HDMI 7inch touch</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Wireless Communication</a><ul class='Nav'><li class='Nav__item '><a href="../Wireless_Communication/WiFi.html">WiFi</a></li><li class='Nav__item '><a href="../Wireless_Communication/WiFi_SoftAP.html">WiFi SoftAP</a></li><li class='Nav__item '><a href="../Wireless_Communication/Bluetooth.html">Bluetooth</a></li><li class='Nav__item '><a href="../Wireless_Communication/Bluetooth_NAP.html">Bluetooth NAP</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Cookbook Linux</a><ul class='Nav'><li class='Nav__item '><a href="../Cookbook_Linux/Understanding_Linux_Software_Management_And_Installing.html">Understanding Linux Software Management And Installing</a></li><li class='Nav__item '><a href="../Cookbook_Linux/Linux_Command_Line_Interface.html">Linux Command Line Interface</a></li><li class='Nav__item '><a href="../Cookbook_Linux/Set_video_output.html">Set video output</a></li><li class='Nav__item '><a href="../Cookbook_Linux/Device_Tree_Editor.html">Device Tree Editor</a></li><li class='Nav__item '><a href="../Cookbook_Linux/Change_Web_Control_Panel_port.html">Change Web Control Panel port</a></li><li class='Nav__item '><a href="../Cookbook_Linux/Turn_off_M4_Arduino_core.html">Turn off M4 Arduino core</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Arduino M4 Processor</a><ul class='Nav'><li class='Nav__item '><a href="../Arduino_M4_Processor/Overview.html">Overview</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Pinout.html">Pinout</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Communication.html">Communication</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Programming_Arduino_M4_from_Internal_Processor(Cortex_A9).html">Programming Arduino M4 from Internal Processor(Cortex-A9)</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Programming_Arduino_M4_from_External_PC.html">Programming Arduino M4 from External PC</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Debugging.html">Debugging</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Arduino_differences.html">Arduino differences</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Porting_Libraries.html">Porting Libraries</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Controlling_9_axis_motion_sensors.html">Controlling 9-axis motion sensors</a></li><li class='Nav__item '><a href="../Arduino_M4_Processor/Use_more_digital_pins_on_M4.html">Use more digital pins on M4</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Cookbook Arduino M4</a><ul class='Nav'><li class='Nav__item '><a href="../Cookbook_Arduino_M4/Hall_Sensor.html">Hall Sensor</a></li><li class='Nav__item '><a href="../Cookbook_Arduino_M4/RGB_led.html">RGB led</a></li><li class='Nav__item '><a href="../Cookbook_Arduino_M4/Two_color_common_cathode_led.html">Two color common cathode led</a></li><li class='Nav__item '><a href="../Cookbook_Arduino_M4/Knock_sensor.html">Knock sensor</a></li><li class='Nav__item '><a href="../Cookbook_Arduino_M4/Infrared_Transmit.html">Infrared Transmit</a></li></ul></li><li class='Nav__item  has-children'><a href="../Serial_Libraries/index.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Serial Libraries</a><ul class='Nav'><li class='Nav__item '><a href="../Serial_Libraries/Java_Serial_Libraries.html">Java Serial Libraries</a></li><li class='Nav__item '><a href="../Serial_Libraries/C_Serial_Libraries.html">C Serial Libraries</a></li><li class='Nav__item '><a href="../Serial_Libraries/PHP_Serial_Libraries.html">PHP Serial Libraries</a></li><li class='Nav__item '><a href="../Serial_Libraries/Python_Serial_Libraries.html">Python Serial Libraries</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Cookbook Android</a><ul class='Nav'><li class='Nav__item '><a href="../Cookbook_Android/UDOO_Android_Boot_Walkthrough.html">UDOO Android Boot Walkthrough</a></li><li class='Nav__item '><a href="../Cookbook_Android/UDOO_Android_Settings.html">UDOO Android Settings</a></li><li class='Nav__item '><a href="../Cookbook_Android/How_To_Install_Gapps_On_UDOO_Running_Android.html">How To Install Gapps On UDOO Running Android</a></li></ul></li><li class='Nav__item Nav__item--open has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Debugging & Troubleshooting</a><ul class='Nav'><li class='Nav__item '><a href="../Debugging_Troubleshooting/Arduino_programming_from_internal_IDE.html">Arduino programming from internal IDE</a></li><li class='Nav__item '><a href="../Debugging_Troubleshooting/Arduino_String_issue.html">Arduino String issue</a></li><li class='Nav__item Nav__item--active'><a href="../Debugging_Troubleshooting/USB_stops_working_after_programming_M4.html">USB stops working after programming M4</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Advanced Topics</a><ul class='Nav'><li class='Nav__item '><a href="../Advanced_Topics/Setup_development_environment.html">Setup development environment</a></li><li class='Nav__item '><a href="../Advanced_Topics/Compile_UDOObuntu_(complete_bootable_image).html">Compile UDOObuntu (complete bootable image)</a></li><li class='Nav__item '><a href="../Advanced_Topics/Compile_U_Boot_Bootloader.html">Compile U-Boot Bootloader</a></li><li class='Nav__item '><a href="../Advanced_Topics/Compile_Linux_Kernel.html">Compile Linux Kernel</a></li><li class='Nav__item '><a href="../Advanced_Topics/Compile_Android_From_Source.html">Compile Android From Source</a></li><li class='Nav__item '><a href="../Advanced_Topics/Recompile_MQX_Libraries.html">Recompile MQX Libraries</a></li><li class='Nav__item '><a href="../Advanced_Topics/Boot_process.html">Boot process</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>Hardware Reference</a><ul class='Nav'><li class='Nav__item '><a href="../Hardware_Reference/Overview.html">Overview</a></li><li class='Nav__item '><a href="../Hardware_Reference/Resources.html">Resources</a></li><li class='Nav__item '><a href="../Hardware_Reference/Board_versions.html">Board versions</a></li><li class='Nav__item '><a href="../Hardware_Reference/Processor.html">Processor</a></li><li class='Nav__item '><a href="../Hardware_Reference/RAM.html">RAM</a></li><li class='Nav__item '><a href="../Hardware_Reference/Power_Management.html">Power Management</a></li><li class='Nav__item '><a href="../Hardware_Reference/PC_USB_interface.html">PC USB interface</a></li><li class='Nav__item '><a href="../Hardware_Reference/Indicator_LED.html">Indicator LED</a></li><li class='Nav__item '><a href="../Hardware_Reference/JTAG_header.html">JTAG header</a></li><li class='Nav__item '><a href="../Hardware_Reference/VADC_Analog_Camera.html">VADC Analog Camera</a></li><li class='Nav__item '><a href="../Hardware_Reference/Ethernet.html">Ethernet</a></li></ul></li><li class='Nav__item  has-children'><a href="#" class="aj-nav folder"><i class="Nav__arrow">&nbsp;</i>UDOO NEO made by the Community</a><ul class='Nav'><li class='Nav__item '><a href="../UDOO_NEO_made_by_the_Community/Python.html">Python</a></li><li class='Nav__item '><a href="../UDOO_NEO_made_by_the_Community/Java.html">Java</a></li><li class='Nav__item '><a href="../UDOO_NEO_made_by_the_Community/Builds_based_on_other_kernels.html">Builds based on other kernels</a></li><li class='Nav__item '><a href="../UDOO_NEO_made_by_the_Community/Drivers_Modules_And_Tools.html">Drivers Modules And Tools</a></li></ul></li></ul>

            <div class="Links">
                                    <hr/>
                                            <a href="https://www.udoo.org" target="_blank">Home</a>
                        <br />
                                            <a href="https://www.udoo.org/downloads" target="_blank">Downloads</a>
                        <br />
                                            <a href="https://www.udoo.org/tutorial" target="_blank">Tutorials</a>
                        <br />
                                            <a href="https://www.udoo.org/forum" target="_blank">Forum</a>
                        <br />
                                    
                
                            </div>
        </div>
    </aside>
    <div class="Columns__right ">
        <div class="Columns__right__content">
            <div class="doc_content">
                <article class="Page">

    <div class="Page__header">
        <h1>USB stops working after programming M4</h1>
            </div>


    <div class="s-content">
        <h2>When it happens</h2> 
At date we have some problems on managing the serial between the two processors.
A too intensive* use may cause malfunctioning.
<h3>Case 1</h3>
It happens each time the 
<code>Serial.print</code> 
method is called. When a <code>Serial.print</code> method is called a new buffer is used each time, up to a maximum of 10 buffers.
If there is no consumer process that empties each buffer A9-side, when 10 buffers get used, it hangs with various consequences.
<p>Be sure that the Arduino sketch will only send data when the A9 consumer process (Python, PHP, C++ program) is ready to consume. Normally after a reboot the Arduino sketch is already running while the A9 side is still starting up. Please make sure your Arduino sketch waits with sending data until the A9 side consuming process confirms to the arduino sketch that it is ready to receive data. Else the 10 buffers will be filled and the Neo will hang.
See for an example Arduino code with this feature: <a href="https://github.com/UDOOboard/serial_libraries_examples/tree/master/Arduino/arduino_serial_example_bidirectional" target="_blank">https://github.com/UDOOboard/serial_libraries_examples/tree/master/Arduino/arduino_serial_example_bidirectional</a></p>
<p>The example in Case 2 will not prevent this issue after a reboot. Please use your example arduino_serial_example_bidirectional.ino</p>
<h3>Case 2</h3>
If you instead got this problem
<pre><code>void setup(){
    Serial.begin(115200);
    pinMode(13, OUTPUT);
}
void loop(){
    while(Serial.available() &gt; 0){
        [ ... ]
    }
}
</code></pre>
<p>then try if it's possible to add little delays after a Serial call.
E.g.</p>
<pre><code>void setup(){
    Serial.begin(115200);
    pinMode(13, OUTPUT);
    delay(100);
}
void loop(){
    while(Serial.available() &gt; 0){
        [ ... ]
    }
    delay(100);
}
</code></pre>
<h2>Solution</h2>
To solve this problem, [connect via Mini USB](!Basic_Setup/Remote_Desktop_(VNC)). Once connected open the terminal and remove this file:
<pre><code>rm /var/opt/m4/m4last.fw
sudo reboot
</code></pre>
<p>Then reboot.</p>
    </div>

        <nav>
        <ul class="Pager">
            <li class=Pager--prev><a href="../Debugging_Troubleshooting/Arduino_String_issue.html">Previous</a></li>            <li class=Pager--next><a href="../Advanced_Topics/Setup_development_environment.html">Next</a></li>        </ul>
    </nav>
    
<span style="float: left; font-size: 10px; color: gray;">
This page was last updated on Friday, June 10, 2022 at 9:21 AM.
</span>

</article>

            </div>
        </div>
    </div>
</div>

    
    <!-- hightlight.js -->
    <script src="../themes/daux/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="../themes/daux/js/daux.js"></script>

            <!-- Tipue Search -->
        <script type="text/javascript" src="../tipuesearch/tipuesearch.js"></script>

        <script>
            window.onunload = function(){}; // force $(document).ready to be called on back/forward navigation in firefox
            $(function() {
                tipuesearch({
                    'base_url': '../'
                });
            });
        </script>
    
</body>
</html>
